# dag-harness configuration
# Generated by: harness init
# Documentation: https://disposable-ansible-dag.ephemera.xoxd.ai

# Database path (relative to this file or absolute)
db_path: {{ db_path | default("harness.db") }}

# Root of the Ansible repository (relative to this file or absolute)
repo_root: {{ repo_root | default(".") }}

# GitLab integration
gitlab:
  project_path: {{ gitlab_project_path | default("org/project") }}
  group_path: {{ gitlab_group_path | default("org") }}
  default_assignee: {{ gitlab_default_assignee | default("") }}
  default_labels:
  {%- for label in gitlab_default_labels | default(["role", "ansible", "molecule"]) %}
  - {{ label }}
  {%- endfor %}
  default_iteration: {{ gitlab_default_iteration | default("") }}

# Git worktree settings
worktree:
  base_path: {{ worktree_base_path | default("..") }}
  branch_prefix: {{ worktree_branch_prefix | default("sid/") }}

# Testing thresholds
testing:
  molecule_required: {{ testing_molecule_required | default(true) }}
  pytest_required: {{ testing_pytest_required | default(true) }}
  deploy_target: {{ testing_deploy_target | default("vmnode852") }}
  molecule_timeout: {{ testing_molecule_timeout | default(600) }}
  pytest_timeout: {{ testing_pytest_timeout | default(300) }}

# Notifications (optional)
notifications:
  enabled: {{ notifications_enabled | default(false) }}
  discord_webhook_url: {{ notifications_discord_webhook_url | default("null") }}
  email_recipient: {{ notifications_email_recipient | default("null") }}

# Observability (optional, requires langsmith extra)
observability:
  langsmith_enabled: {{ observability_langsmith_enabled | default(false) }}
  langsmith_project: {{ observability_langsmith_project | default("dag-harness") }}
  anonymize_sensitive: {{ observability_anonymize_sensitive | default(true) }}

# Wave definitions - map roles to execution waves
# Roles within the same wave can run in parallel;
# waves execute sequentially (wave 0 before wave 1, etc.)
waves:
  0:
    name: Foundation
    roles:
    - common
  1:
    name: Infrastructure Foundation
    roles:
    {%- for role in wave1_roles | default(["windows_prerequisites", "ems_registry_urls", "iis-config"]) %}
    - {{ role }}
    {%- endfor %}
  2:
    name: Core Platform
    roles:
    {%- for role in wave2_roles | default(["ems_platform_services", "ems_web_app", "database_clone", "ems_download_artifacts"]) %}
    - {{ role }}
    {%- endfor %}
  3:
    name: Web Applications
    roles:
    {%- for role in wave3_roles | default(["ems_master_calendar", "ems_master_calendar_api", "ems_campus_webservice", "ems_desktop_deploy"]) %}
    - {{ role }}
    {%- endfor %}
  4:
    name: Supporting Services
    roles:
    {%- for role in wave4_roles | default(["grafana_alloy_windows", "email_infrastructure", "hrtk_protected_users", "ems_environment_util"]) %}
    - {{ role }}
    {%- endfor %}
