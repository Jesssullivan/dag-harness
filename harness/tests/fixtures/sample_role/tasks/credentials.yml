---
# Credential retrieval tasks

- name: Get WinRM credentials from 1Password
  ansible.builtin.set_fact:
    winrm_password: "{{ lookup('op', 'ansible-self', 'password') }}"

- name: Get database credentials
  ansible.builtin.set_fact:
    sql_sa_password: "{{ op_read('dev-sql-sa', 'password') }}"
  no_log: true

- name: Get API token (base58 encoded)
  ansible.builtin.set_fact:
    api_token: "{{ op_read('ems-api-token', 'credential') | decode_base58 }}"

- name: Get service account credentials
  community.general.onepassword_info:
    item: service-account-prod
    vault: EMS
  register: service_account
  no_log: true

- name: Access credentials from variable
  ansible.builtin.debug:
    msg: "Using credential: {{ op_credentials['admin-backup'] }}"
